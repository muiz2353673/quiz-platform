<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <title>Quiz Results - Quiz Platform</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="/dashboard">Quiz Platform</a>
        <div class="navbar-nav ms-auto">
          <span class="navbar-text me-3" sec:authentication="name"
            >Welcome!</span
          >
          <form th:action="@{/logout}" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-light">Logout</button>
          </form>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <div class="row">
        <div class="col-md-12">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
              Quiz Results: <span th:text="${quiz.title}">Quiz Title</span>
            </h1>
            <a th:href="@{/recruiter/quizzes}" class="btn btn-secondary"
              >Back to Quizzes</a
            >
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Quiz Information</h5>
              <p class="card-text">
                <strong>Description:</strong>
                <span th:text="${quiz.description}">Description</span>
              </p>
              <p class="card-text">
                <strong>Duration:</strong>
                <span th:text="${quiz.durationInMinutes}">Duration</span>
                minutes
              </p>
              <p class="card-text">
                <strong>Total Submissions:</strong>
                <span th:text="${submissions.size()}">0</span>
              </p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Candidate Submissions</h5>
            </div>
            <div class="card-body">
              <div th:if="${submissions.isEmpty()}" class="text-center py-4">
                <p class="text-muted">No submissions yet for this quiz.</p>
              </div>

              <div th:if="${!submissions.isEmpty()}">
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Candidate</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Total Questions</th>
                        <th>Submission Time</th>
                        <th>Performance</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="submission : ${submissions}">
                        <td th:text="${submission.candidate.username}">
                          Candidate
                        </td>
                        <td
                          th:text="${submission.score} + '/' + ${submission.totalQuestions}"
                        >
                          Score
                        </td>
                        <td>
                          <span
                            th:text="${#numbers.formatDecimal(submission.percentage, 1, 1)} + '%'"
                            >Percentage</span
                          >
                        </td>
                        <td th:text="${submission.totalQuestions}">Total</td>
                        <td
                          th:text="${#temporals.format(submission.submissionTime, 'dd/MM/yyyy HH:mm')}"
                        >
                          Time
                        </td>
                        <td>
                          <span
                            th:if="${submission.percentage >= 80}"
                            class="badge bg-success"
                            >Excellent</span
                          >
                          <span
                            th:if="${submission.percentage >= 60 && submission.percentage < 80}"
                            class="badge bg-warning"
                            >Good</span
                          >
                          <span
                            th:if="${submission.percentage >= 40 && submission.percentage < 60}"
                            class="badge bg-info"
                            >Average</span
                          >
                          <span
                            th:if="${submission.percentage < 40}"
                            class="badge bg-danger"
                            >Needs Improvement</span
                          >
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Summary Statistics -->
                <div class="row mt-4">
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5
                          class="card-title text-primary"
                          th:text="${submissions.size()}"
                        >
                          0
                        </h5>
                        <p class="card-text">Total Submissions</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5
                          class="card-title text-success"
                          th:text="${#numbers.formatDecimal(averageScore, 1, 1)} + '%'"
                        >
                          0%
                        </h5>
                        <p class="card-text">Average Score</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5
                          class="card-title text-info"
                          th:text="${#numbers.formatDecimal(highestScore, 1, 1)} + '%'"
                        >
                          0%
                        </h5>
                        <p class="card-text">Highest Score</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5
                          class="card-title text-warning"
                          th:text="${#numbers.formatDecimal(lowestScore, 1, 1)} + '%'"
                        >
                          0%
                        </h5>
                        <p class="card-text">Lowest Score</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
